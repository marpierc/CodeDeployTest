language: java
jdk:
   - oraclejdk8
sudo: true
addons:
  mariadb: '10.1'
  sauce_connect:
     username: marpierc
     access_key:
       secure: "ddACjw1ko4J/4d1Z6x3zKBD6Bj5YddSfknpa5P9OXsKzc6aFDmOMmOpS9dzT4JrMizlT+lJfBaQqKi4dOtJ1FYgakvWc4wwixnLcPTKtaLKuMWI0NwEOLpVnC4xrxAN5muTHlAF5F135r3Y39yX1x60mrAcNflpFaROW5VWc/zk0lIM0CZU85FQqwW/JJ9f36wLgk734PSlUn/XOXIK73XO/5GbVpjEtDRc+d9kVsJ7i+piQPoiGQD6Kd7xjRnQJcYnIwWK1peVL4rJhnwFYav6tHBE1Bw+ORgntvSMmazXtR1vYVvqHxTcnILvjoAnam5rojZib0/BVfEVPTszJBCAupQ2MUibrfZQJyEiU9PJNjM6SjqI8sMLMgKqIrBg6/FNwR3M/WmnBlYDzoonJbI6gfnx2V7B65WnTwQsaEoQhZK8gjnA/nnCdfSQ6DAZQBTY5YCaWZwL1MJ27kPu0KjKEO7dAvapyfyN2R6cy7iIR6Tb+6a+S3JbcFD1peN4EjH5IMf0s7yDClRO4fS7/EoBpy5E4SuKIH+Yb5VWuuVu3NbnftIgUjvWR2YMBg2UoeM9Ih+5W67z8vWE2UrvQS7LL1bku5XKmGyXu9PIiipsTdgGoiqP6XMVz0ubTWyoOdyWGKYtiasyTADIcjSPrDDSmML4wR4J9iS91VqZlWFw="
       
services:
   - rabbitmq
install: true
before_script:
   - sudo apt-get install zookeeper
   - mysql -e 'create database app_catalog;'
   - cd scripts
   - source replace_props.sh
   - cd -
script: cd . && echo "mvn -e clean install"
before_deploy:
   - cd $TRAVIS_BUILD_DIR
   - tar -cf CodeDeployTest.tar . || true
   - mkdir -p "dpl_cd_upload"
   - mv CodeDeployTest.tar dpl_cd_upload/CodeDeployTest.tar || true
deploy:
   - provider: s3
     access_key_id: $AWS_ACCESS_KEY
     secret_access_key: $AWS_SECRET_KEY
     local_dir: dpl_cd_upload
     bucket: airavata-develop
     region: us-east-1
     skip_cleanup: true
     acl: public_read
     detect_encoding: true
     on:
       repo: marpierc/CodeDeployTest
       all_branches: true
   - provider: codedeploy
     access_key_id: $AWS_ACCESS_KEY
     secret_access_key: $AWS_SECRET_KEY
     bucket: airavata-develop
     key: CodeDeployTest.tar
     bundle_type: tar
     application: MEP-Test-CodeDeploy
     deployment_group: MEP-Test-CodeDeploy
     region: us-east-1
     on:
       repo: marpierc/CodeDeployTest
       all_branches: true
after_deploy:
   - echo "Performing after deploy procedures..."
notifications:
  email:
    recipients:
       - marpierc@iu.edu

